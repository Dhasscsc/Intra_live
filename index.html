<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>à®²à¯ˆà®µà¯ à®¸à¯à®Ÿà®¾à®•à¯ à®Ÿà®¾à®·à¯à®ªà¯‹à®°à¯à®Ÿà¯</title>
    <style>
        :root {
            --bg-color: #f4f6f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --green: #00c853;
            --red: #ff3d00;
            --blue: #2962ff;
            --highlight: #fff9c4;
            --border-color: #ddd;
            --yellow: #ffd600;
            --purple: #9c27b0;
            --orange: #ff9800;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 11px;
            line-height: 1.3;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header --- */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--card-bg), #f8f9fa);
            padding: 8px 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .header-title h2 { 
            margin: 0; 
            font-size: 16px; 
            color: var(--blue); 
            white-space: nowrap;
        }
        .header-time { 
            font-size: 12px; 
            font-weight: bold; 
            color: #555;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
        }

        /* --- Search and Controls Container --- */
        .top-controls {
            display: flex;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .search-box {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 11px;
            background: white;
        }
        .search-box:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 2px rgba(41, 98, 255, 0.1);
        }

        .quick-filters {
            display: flex;
            gap: 4px;
        }
        .quick-filter-btn {
            padding: 4px 8px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            white-space: nowrap;
        }
        .quick-filter-btn.active {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }

        button {
            padding: 4px 8px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer;
            font-size: 10px; 
            font-weight: 600; 
            color: white;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
        }
        button:hover { opacity: 0.9; }
        button:active { transform: scale(0.98); }
        .btn-refresh { background-color: var(--blue); }
        .btn-print { background-color: #666; }
        .btn-whatsapp { background-color: #25D366; }
        .btn-selected { background-color: var(--purple); }
        .btn-clear { background-color: #f44336; }
        .btn-filter { background-color: #4CAF50; }
        .btn-buy-whatsapp { background-color: var(--green); }
        .btn-sell-whatsapp { background-color: var(--red); }
        .btn-view-toggle { background-color: var(--orange); }

        /* --- Stats Container --- */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 6px;
            padding: 8px 12px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        .stat-card:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .stat-card.active { 
            border-color: var(--blue); 
            background-color: #e3f2fd; 
        }
        .stat-card h3 { 
            margin: 0 0 3px 0; 
            font-size: 9px; 
            color: #666; 
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .stat-card .value { 
            font-size: 14px; 
            font-weight: bold; 
            color: var(--text-color); 
        }
        .text-green { color: var(--green) !important; }
        .text-red { color: var(--red) !important; }
        .text-blue { color: var(--blue) !important; }
        .text-yellow { color: var(--yellow) !important; }
        .text-purple { color: var(--purple) !important; }
        .text-orange { color: var(--orange) !important; }

        /* --- Main Content Area (Split view) --- */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 8px;
            padding: 8px;
        }

        /* --- Table Section --- */
        .table-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0; /* Important for flexbox with tables */
        }

        .table-wrapper {
            background: var(--card-bg);
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            overflow-x: auto;
            flex: 1;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            white-space: nowrap;
            table-layout: fixed;
            min-width: 1000px;
        }

        th, td {
            padding: 4px 6px;
            border-bottom: 1px solid var(--border-color);
            text-align: right;
            height: 26px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            text-align: center;
            font-size: 10px;
            padding: 6px 4px;
        }

        /* Column widths */
        .col-check { width: 30px; }
        .col-stock { width: 100px; text-align: left; }
        .col-price { width: 70px; }
        .col-change { width: 60px; }
        .col-percent { width: 55px; }
        .col-low { width: 60px; }
        .col-diff { width: 50px; }
        .col-high { width: 60px; }
        .col-volume { width: 75px; }
        .col-close { width: 65px; }
        .col-open { width: 65px; }
        .col-pchange { width: 65px; }
        .col-mchange { width: 65px; }
        .col-52high { width: 70px; }
        .col-52low { width: 70px; }
        .col-52h3 { width: 55px; }

        /* Sticky columns */
        th:first-child, td:first-child { 
            position: sticky;
            left: 0;
            background-color: #2c3e50;
            z-index: 20;
            text-align: center;
        }
        td:first-child {
            background-color: var(--card-bg);
            z-index: 15;
        }
        
        th:nth-child(2), td:nth-child(2) { 
            position: sticky;
            left: 30px;
            background-color: #2c3e50;
            z-index: 20;
            text-align: left;
        }
        td:nth-child(2) { 
            background-color: var(--card-bg);
            z-index: 15;
            cursor: pointer;
            font-weight: 600;
        }

        /* Row styles */
        .positive { color: var(--green); font-weight: 600; }
        .negative { color: var(--red); font-weight: 600; }
        .neutral { color: #666; }
        
        tr:hover td {
            background-color: rgba(0, 0, 0, 0.02);
        }
        tr.highlight-row td {
            background-color: var(--highlight) !important;
            font-weight: 600;
        }
        tr.selected-row td {
            background-color: rgba(156, 39, 176, 0.1) !important;
        }
        tr.buy-row td:nth-child(2) { border-left: 3px solid var(--green); }
        tr.sell-row td:nth-child(2) { border-left: 3px solid var(--red); }

        /* --- Right Panel --- */
        .right-panel {
            width: 300px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .panel-section {
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: #2c3e50;
            color: white;
            padding: 6px 10px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            max-height: 150px;
        }

        .panel-large {
            flex: 1;
            max-height: none;
        }

        /* Selection list */
        .selection-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 6px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 10px;
        }
        .selection-item:last-child {
            border-bottom: none;
        }
        .selection-item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .selection-item-value {
            font-weight: 600;
            margin-left: 8px;
        }
        .selection-item-remove {
            color: #ff4444;
            cursor: pointer;
            font-weight: bold;
            margin-left: 4px;
        }

        /* WhatsApp buttons container */
        .whatsapp-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            padding: 8px;
        }

        /* Status Bar */
        #statusBar {
            font-size: 9px;
            color: #666;
            padding: 4px 12px;
            background: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        /* Loading */
        #loading { 
            text-align: center; 
            padding: 20px; 
            color: #666; 
            font-weight: 600; 
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--blue);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-bottom: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast */
        #toast {
            visibility: hidden; 
            min-width: 200px; 
            background-color: #333; 
            color: #fff;
            text-align: center; 
            border-radius: 4px; 
            padding: 8px;
            position: fixed; 
            z-index: 1000; 
            left: 50%; 
            bottom: 20px;
            transform: translateX(-50%); 
            font-size: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        #toast.show { 
            visibility: visible; 
            animation: fadein 0.3s, fadeout 0.3s 2s; 
        }
        @keyframes fadein { 
            from {bottom: 0; opacity: 0;} 
            to {bottom: 20px; opacity: 1;} 
        }
        @keyframes fadeout { 
            from {bottom: 20px; opacity: 1;} 
            to {bottom: 0; opacity: 0;} 
        }

        /* Selection counter */
        .selection-counter {
            background: var(--purple);
            color: white;
            padding: 1px 4px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 600;
            margin-left: 3px;
        }

        /* Print Styles - Optimized */
        @media print {
            body {
                height: auto;
                overflow: visible;
                background: white;
                font-size: 10px;
                padding: 0;
                margin: 0;
            }
            
            .dashboard-header, 
            .top-controls, 
            .stats-container, 
            .right-panel,
            #statusBar,
            #toast {
                display: none !important;
            }
            
            .main-container {
                display: block;
                padding: 0;
                margin: 0;
            }
            
            .table-section {
                width: 100%;
            }
            
            .table-wrapper {
                box-shadow: none;
                border: 1px solid #000;
                border-radius: 0;
                overflow: visible;
                page-break-inside: avoid;
            }
            
            table {
                width: 100%;
                min-width: 100%;
                table-layout: auto;
                border-collapse: collapse;
            }
            
            th, td {
                border: 1px solid #000 !important;
                padding: 3px 5px;
                background: white !important;
                color: black !important;
                position: static !important;
                text-align: right;
            }
            
            th {
                background: #ddd !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-weight: bold;
            }
            
            th:first-child, td:first-child,
            th:nth-child(2), td:nth-child(2) {
                position: static !important;
                left: auto !important;
            }
            
            .positive { color: black !important; font-weight: bold; }
            .negative { color: black !important; font-weight: bold; }
            
            /* Remove interactive elements */
            input[type="checkbox"] {
                display: none;
            }
            
            /* Print header */
            @page {
                margin: 0.5cm;
                size: landscape;
            }
            
            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 10px;
                font-size: 14px;
                font-weight: bold;
            }
            
            .print-footer {
                display: block !important;
                text-align: center;
                margin-top: 10px;
                font-size: 9px;
                color: #666;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .right-panel {
                width: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
            }
            .panel-section {
                flex: 1;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>

    <!-- Print Header (Hidden by default) -->
    <div class="print-header" style="display: none;">
        <h2>à®¸à¯à®Ÿà®¾à®•à¯ à®®à®¾à®°à¯à®•à¯à®•à¯†à®Ÿà¯ à®°à®¿à®ªà¯à®ªà¯‹à®°à¯à®Ÿà¯</h2>
        <div>à®¤à¯‡à®¤à®¿: <span id="print-date"></span> | à®¨à¯‡à®°à®®à¯: <span id="print-time"></span></div>
    </div>

    <!-- Main Dashboard -->
    <header class="dashboard-header">
        <div class="header-title">
            <h2>ğŸ“ˆ à®²à¯ˆà®µà¯ à®¸à¯à®Ÿà®¾à®•à¯ à®Ÿà®¾à®·à¯à®ªà¯‹à®°à¯à®Ÿà¯</h2>
        </div>
        <div class="header-time" id="clock">00:00:00</div>
    </header>

    <!-- Search and Quick Controls -->
    <div class="top-controls">
        <input type="text" 
               class="search-box" 
               id="searchBox" 
               placeholder="ğŸ” à®ªà®™à¯à®•à¯ à®¤à¯‡à®Ÿà®²à¯..."
               onkeyup="filterTable()">
        
        <div class="quick-filters">
            <span class="quick-filter-btn active" onclick="quickFilter('all')">à®…à®©à¯ˆà®¤à¯à®¤à¯à®®à¯</span>
            <span class="quick-filter-btn" onclick="quickFilter('gainers')">ğŸ“ˆ à®‰à®¯à®°à¯à®µà¯</span>
            <span class="quick-filter-btn" onclick="quickFilter('losers')">ğŸ“‰ à®‡à®´à®ªà¯à®ªà¯</span>
            <span class="quick-filter-btn" onclick="quickFilter('volume')">ğŸ’¹ à®µà®¾à®²à¯à®¯à¯‚à®®à¯</span>
        </div>

        <button class="btn-refresh" onclick="loadData()" title="à®ªà¯à®¤à¯à®ªà¯à®ªà®¿">
            ğŸ”„ à®ªà¯à®¤à¯à®ªà¯à®ªà®¿
        </button>
        
        <button class="btn-view-toggle" onclick="toggleView()" title="à®ªà®¾à®°à¯à®µà¯ˆ à®®à®¾à®±à¯à®±à¯">
            ğŸ‘ï¸ à®ªà®¾à®°à¯à®µà¯ˆ
        </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-container">
        <div class="stat-card active" id="card-total" onclick="filterData('all')">
            <h3>à®®à¯Šà®¤à¯à®¤à®®à¯</h3>
            <div class="value" id="count-total">0</div>
        </div>
        <div class="stat-card" id="card-buy" onclick="filterData('buy')">
            <h3>ğŸŸ¢ à®ªà¯ˆ</h3>
            <div class="value text-green" id="count-buy">0</div>
        </div>
        <div class="stat-card" id="card-sell" onclick="filterData('sell')">
            <h3>ğŸ”´ à®šà¯†à®²à¯</h3>
            <div class="value text-red" id="count-sell">0</div>
        </div>
        <div class="stat-card" id="card-gainers" onclick="quickFilter('gainers')">
            <h3>ğŸ“ˆ à®‰à®¯à®°à¯à®µà¯</h3>
            <div class="value text-green" id="count-gainers">0</div>
        </div>
        <div class="stat-card" id="card-losers" onclick="quickFilter('losers')">
            <h3>ğŸ“‰ à®‡à®´à®ªà¯à®ªà¯</h3>
            <div class="value text-red" id="count-losers">0</div>
        </div>
        <div class="stat-card" id="card-selected" onclick="showSelectedStocks()">
            <h3>à®¤à¯‡à®°à¯à®µà¯ <span id="selected-count" class="selection-counter">0</span></h3>
            <div class="value text-purple" id="count-selected">0</div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-container">
        <!-- Table Section -->
        <div class="table-section">
            <div class="table-wrapper">
                <div id="loading">
                    <div class="spinner"></div>
                    à®¤à®°à®µà¯à®•à®³à¯ˆ à®à®±à¯à®±à¯à®•à®¿à®±à®¤à¯...
                </div>
                <table id="stockTable" style="display:none;">
                    <thead>
                        <tr>
                            <th class="col-check" title="à®¤à¯‡à®°à¯à®µà¯">
                                <input type="checkbox" id="select-all" onclick="toggleSelectAll(this)">
                            </th>
                            <th class="col-stock" title="à®ªà®™à¯à®•à¯">à®ªà®™à¯à®•à¯</th>
                            <th class="col-price" title="à®µà®¿à®²à¯ˆ">à®µà®¿à®²à¯ˆ</th>
                            <th class="col-change" title="à®®à®¾à®±à¯à®±à®®à¯">à®®à®¾à®±à¯à®±à®®à¯</th>
                            <th class="col-percent" title="%">%</th>
                            <th class="col-low" title="à®²à¯‹">à®²à¯‹</th>
                            <th class="col-diff" title="-">(-)</th>
                            <th class="col-high" title="à®¹à¯ˆ">à®¹à¯ˆ</th>
                            <th class="col-diff" title="+">(+)</th>
                            <th class="col-volume" title="à®µà®¾à®²à¯à®¯à¯‚à®®à¯">à®µà®¾à®²à¯à®¯à¯‚à®®à¯</th>
                            <th class="col-close" title="à®•à¯à®³à¯‹à®¸à¯">à®•à¯à®³à¯‹à®¸à¯</th>
                            <th class="col-open" title="à®“à®ªà®©à¯">à®“à®ªà®©à¯</th>
                            <th class="col-pchange" title="P.à®šà¯‡">P.à®šà¯‡</th>
                            <th class="col-mchange" title="M.à®šà¯‡">M.à®šà¯‡</th>
                            <th class="col-52high" title="52H">52H</th>
                            <th class="col-52low" title="52L">52L</th>
                            <th class="col-52h3" title="52H/3">52H/3</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- WhatsApp Sharing Panel -->
            <div class="panel-section">
                <div class="panel-header">
                    <span>ğŸ“± WhatsApp à®ªà®•à®¿à®°à¯à®µà¯</span>
                </div>
                <div class="whatsapp-buttons">
                    <button class="btn-buy-whatsapp" onclick="shareSelectedStocks('buy')">
                        ğŸŸ¢ à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯
                    </button>
                    <button class="btn-sell-whatsapp" onclick="shareSelectedStocks('sell')">
                        ğŸ”´ à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯
                    </button>
                    <button class="btn-selected" onclick="shareSelectedStocks('selected')" style="grid-column: span 2;">
                        ğŸ“‹ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®¤à¯à®¤à®µà¯ˆ
                    </button>
                    <button class="btn-whatsapp" onclick="shareSelectedStocks('all')" style="grid-column: span 2;">
                        ğŸ“Š à®…à®©à¯ˆà®¤à¯à®¤à¯à®®à¯
                    </button>
                </div>
            </div>

            <!-- Selected Stocks Panel -->
            <div class="panel-section panel-large">
                <div class="panel-header">
                    <span>ğŸ“‹ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®¤à¯à®¤ à®ªà®™à¯à®•à¯à®•à®³à¯</span>
                    <button class="btn-clear" onclick="clearSelections()" style="padding: 2px 6px; font-size: 9px;">
                        âŒ à®¨à¯€à®•à¯à®•à¯
                    </button>
                </div>
                <div class="panel-content" id="selectedStocksPanel">
                    <div style="color: #666; text-align: center; padding: 10px;">
                        à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ
                    </div>
                </div>
            </div>

            <!-- Buy/Sell Summary Panel -->
            <div class="panel-section">
                <div class="panel-header">
                    <span>ğŸ“Š à®šà¯à®°à¯à®•à¯à®•à®®à¯</span>
                </div>
                <div class="panel-content">
                    <div class="selection-item">
                        <span>à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯:</span>
                        <span class="text-green" id="panel-buy-count">0</span>
                    </div>
                    <div class="selection-item">
                        <span>à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯:</span>
                        <span class="text-red" id="panel-sell-count">0</span>
                    </div>
                    <div class="selection-item">
                        <span>à®¤à¯‡à®°à¯à®µà¯ à®ªà®™à¯à®•à¯à®•à®³à¯:</span>
                        <span class="text-purple" id="panel-selected-count">0</span>
                    </div>
                    <div class="selection-item">
                        <span>à®®à¯Šà®¤à¯à®¤ à®ªà®™à¯à®•à¯à®•à®³à¯:</span>
                        <span id="panel-total-count">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Bar -->
    <div id="statusBar">
        <span id="statusText">à®¤à®¯à®¾à®°à¯</span>
        <span id="rowCount">0 à®ªà®™à¯à®•à¯à®•à®³à¯</span>
        <span id="lastUpdate">à®•à®Ÿà¯ˆà®šà®¿: --:--</span>
        <span id="viewInfo">à®…à®©à¯ˆà®¤à¯à®¤à¯à®®à¯</span>
    </div>

    <!-- Toast -->
    <div id="toast"></div>

    <!-- Print Footer (Hidden by default) -->
    <div class="print-footer" style="display: none;">
        <div>à®¸à¯à®Ÿà®¾à®•à¯ à®®à®¾à®°à¯à®•à¯à®•à¯†à®Ÿà¯ à®°à®¿à®ªà¯à®ªà¯‹à®°à¯à®Ÿà¯ | à®ªà®•à¯à®•à®®à¯ 1</div>
        <div>Generated by Stock Dashboard</div>
    </div>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDDw_0R5I72Kp1RSTOTaJEGmAEUBInSF_bSneyvtb1sc-UED_3y7jbBAIC22rp2sUWSLowZ9C5Ri2l/pub?output=csv&gid=1778670401';
        let stocksData = [];
        let currentFilter = 'all';
        let selectedStocks = new Set();
        let searchTerm = '';
        let fullScreenTable = false;
        let lastPrintedDate = '';

        // Load data
        async function loadData() {
            showLoading(true);
            try {
                const timestamp = Date.now();
                const response = await fetch(`${SHEET_URL}&_=${timestamp}`);
                
                if (!response.ok) throw new Error(`Network error: ${response.status}`);
                
                const text = await response.text();
                
                if (!text || text.trim().length < 10) {
                    throw new Error('Empty CSV data');
                }
                
                parseCSV(text);
                updateDashboard();
                renderTable();
                updateSelectedPanel();
                showToast('à®¤à®°à®µà¯ à®ªà¯à®¤à¯à®ªà¯à®ªà®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯');
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loading').innerHTML = 
                    `<div style="color: var(--red); padding: 15px; text-align: center;">
                        âŒ à®¤à®°à®µà¯ à®à®±à¯à®±à¯à®¤à®²à¯ à®¤à¯‹à®²à¯à®µà®¿<br>
                        <button onclick="loadData()" style="margin-top: 5px; padding: 3px 8px; background: var(--blue); color: white; border: none; border-radius: 3px; font-size: 10px;">
                            à®®à¯€à®£à¯à®Ÿà¯à®®à¯ à®®à¯à®¯à®±à¯à®šà®¿à®•à¯à®•à®µà¯à®®à¯
                        </button>
                    </div>`;
                showToast('à®¤à®°à®µà¯ à®à®±à¯à®±à¯à®¤à®²à¯ à®¤à¯‹à®²à¯à®µà®¿');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
            document.getElementById('stockTable').style.display = show ? 'none' : 'table';
        }

        // Parse CSV
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim().length > 0);
            stocksData = [];
            
            for (let i = 1; i < lines.length; i++) {
                try {
                    const cols = parseCSVLine(lines[i]);
                    if (cols.length < 5) continue;
                    
                    const orderBuy = cols[0]?.toLowerCase().trim() || '';
                    const orderSell = cols[2]?.toLowerCase().trim() || '';
                    const stockName = cols[3]?.trim() || 'N/A';
                    
                    let percent = 0;
                    const percentStr = cols[6] || "0";
                    if (percentStr.includes('%')) {
                        percent = parseFloat(percentStr.replace('%', '').replace(',', '')) || 0;
                    } else {
                        percent = parseFloat(percentStr) || 0;
                    }
                    
                    const price = parseFloat(cols[4]) || 0;
                    const change = parseFloat(cols[5]) || 0;
                    const low = parseFloat(cols[7]) || 0;
                    const high = parseFloat(cols[9]) || 0;
                    const volume = parseFloat(cols[11]) || 0;
                    const close = parseFloat(cols[12]) || 0;
                    const open = parseFloat(cols[13]) || 0;
                    
                    stocksData.push({
                        raw: cols,
                        orderBuy,
                        orderSell,
                        stock: stockName,
                        percent,
                        price,
                        change,
                        low,
                        high,
                        volume,
                        close,
                        open,
                        diffLow: price - low,
                        diffHigh: high - price,
                        id: `${stockName}_${i}`,
                        symbol: stockName.split(' ')[0]
                    });
                    
                } catch (error) {
                    console.warn(`Line ${i} error:`, error);
                }
            }
            
            // Sort by absolute percent
            stocksData.sort((a, b) => Math.abs(b.percent) - Math.abs(a.percent));
        }

        function parseCSVLine(line) {
            const result = [];
            let inQuotes = false;
            let currentField = '';
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(currentField);
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            
            result.push(currentField);
            return result.map(field => field.trim());
        }

        function updateDashboard() {
            const total = stocksData.length;
            const buyCount = stocksData.filter(s => s.orderBuy === 'buy').length;
            const sellCount = stocksData.filter(s => s.orderSell === 'sell').length;
            const gainers = stocksData.filter(s => s.percent > 0).length;
            const losers = stocksData.filter(s => s.percent < 0).length;
            
            document.getElementById('count-total').innerText = total;
            document.getElementById('count-buy').innerText = buyCount;
            document.getElementById('count-sell').innerText = sellCount;
            document.getElementById('count-gainers').innerText = gainers;
            document.getElementById('count-losers').innerText = losers;
            
            // Update panel counts
            document.getElementById('panel-buy-count').innerText = buyCount;
            document.getElementById('panel-sell-count').innerText = sellCount;
            document.getElementById('panel-total-count').innerText = total;
            
            // Update last update time
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `à®•à®Ÿà¯ˆà®šà®¿: ${now.toLocaleTimeString('ta-IN', {hour: '2-digit', minute:'2-digit'})}`;
            
            document.getElementById('rowCount').textContent = `${total} à®ªà®™à¯à®•à¯à®•à®³à¯`;
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Filter data
            let displayData = stocksData;
            
            if (currentFilter === 'buy') {
                displayData = displayData.filter(s => s.orderBuy === 'buy');
            } else if (currentFilter === 'sell') {
                displayData = displayData.filter(s => s.orderSell === 'sell');
            }
            
            // Apply search filter
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                displayData = displayData.filter(s => 
                    s.stock.toLowerCase().includes(term) || 
                    s.symbol.toLowerCase().includes(term)
                );
            }

            if (displayData.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 17;
                td.style.textAlign = 'center';
                td.style.padding = '20px';
                td.style.color = '#666';
                td.innerHTML = searchTerm ? 
                    `"${searchTerm}"à®•à¯à®•à¯ à®¤à®°à®µà¯ à®‡à®²à¯à®²à¯ˆ` : 
                    'à®¤à®°à®µà¯ à®•à®¿à®Ÿà¯ˆà®•à¯à®•à®µà®¿à®²à¯à®²à¯ˆ';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }

            // Render all rows (full height)
            displayData.forEach((row, index) => {
                const tr = document.createElement('tr');
                if (selectedStocks.has(row.id)) tr.classList.add('selected-row');
                if (row.orderBuy === 'buy') tr.classList.add('buy-row');
                if (row.orderSell === 'sell') tr.classList.add('sell-row');
                
                // Helper functions
                const getColorClass = (value) => {
                    const num = parseFloat(value);
                    if (num > 0) return 'positive';
                    if (num < 0) return 'negative';
                    return 'neutral';
                };

                // 1. Checkbox
                const tdCheck = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = "checkbox";
                checkbox.checked = selectedStocks.has(row.id);
                checkbox.dataset.index = index;
                checkbox.onclick = (e) => {
                    e.stopPropagation();
                    toggleSelection(row.id, checkbox.checked);
                };
                tdCheck.appendChild(checkbox);
                tr.appendChild(tdCheck);

                // 2. Stock Name
                const tdStock = document.createElement('td');
                tdStock.innerHTML = `<strong>${row.stock}</strong>`;
                tdStock.onclick = () => {
                    highlightRow(tr);
                    toggleSelection(row.id, !selectedStocks.has(row.id));
                };
                tdStock.style.cursor = 'pointer';
                tr.appendChild(tdStock);

                // 3. Price
                const tdPrice = document.createElement('td');
                tdPrice.innerText = row.price.toFixed(2);
                tdPrice.className = getColorClass(row.price);
                tr.appendChild(tdPrice);

                // 4. Change
                const tdChange = document.createElement('td');
                tdChange.innerText = row.change.toFixed(2);
                tdChange.className = getColorClass(row.change);
                tr.appendChild(tdChange);

                // 5. Percent
                const tdPercent = document.createElement('td');
                tdPercent.innerText = `${row.percent.toFixed(2)}%`;
                tdPercent.className = getColorClass(row.percent);
                tr.appendChild(tdPercent);

                // 6-9. Low, Diff, High, Diff
                const values = [
                    row.low.toFixed(2),
                    row.diffLow.toFixed(2),
                    row.high.toFixed(2),
                    row.diffHigh.toFixed(2)
                ];
                
                values.forEach((val, i) => {
                    const td = document.createElement('td');
                    td.innerText = val;
                    if (i === 1 || i === 3) {
                        td.className = parseFloat(val) >= 0 ? 'positive' : 'negative';
                    }
                    tr.appendChild(td);
                });

                // 10. Volume
                const tdVol = document.createElement('td');
                tdVol.innerText = formatVolume(row.volume);
                tr.appendChild(tdVol);

                // 11-14. Movement columns
                const movementValues = [
                    row.close.toFixed(2),
                    row.open.toFixed(2),
                    row.raw[14] || '-',
                    row.raw[15] || '-'
                ];
                
                movementValues.forEach((val, i) => {
                    const td = document.createElement('td');
                    td.innerText = val;
                    if (i === 2 || i === 3) {
                        td.className = getColorClass(val);
                    }
                    tr.appendChild(td);
                });

                // 15-17. 52 Week data
                const week52Indices = [17, 19, 20];
                week52Indices.forEach(idx => {
                    const td = document.createElement('td');
                    td.innerText = row.raw[idx] || '-';
                    tr.appendChild(td);
                });

                // Row click
                tr.onclick = (e) => {
                    if (e.target.type !== 'checkbox') {
                        highlightRow(tr);
                    }
                };

                tbody.appendChild(tr);
            });

            updateSelectionCount();
            updateViewInfo();
        }

        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(2) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(1) + 'K';
            }
            return volume.toString();
        }

        // Search and Filter Functions
        function filterTable() {
            searchTerm = document.getElementById('searchBox').value.trim();
            renderTable();
        }

        function quickFilter(type) {
            // Update quick filter buttons
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Apply filter
            let displayData = [...stocksData];
            
            if (type === 'gainers') {
                displayData = displayData.filter(s => s.percent > 0)
                    .sort((a, b) => b.percent - a.percent);
                currentFilter = 'gainers';
            } else if (type === 'losers') {
                displayData = displayData.filter(s => s.percent < 0)
                    .sort((a, b) => a.percent - b.percent);
                currentFilter = 'losers';
            } else if (type === 'volume') {
                displayData = displayData.sort((a, b) => b.volume - a.volume);
                currentFilter = 'volume';
            } else if (type === 'all') {
                displayData = displayData.sort((a, b) => Math.abs(b.percent) - Math.abs(a.percent));
                currentFilter = 'all';
            }
            
            // Update stats cards
            document.querySelectorAll('.stat-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`card-${type}`).classList.add('active');
            
            renderTable();
            showToast(type === 'all' ? 'à®…à®©à¯ˆà®¤à¯à®¤à¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 
                     type === 'gainers' ? 'à®…à®¤à®¿à®•à®°à®¿à®ªà¯à®ªà¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 
                     type === 'losers' ? 'à®‡à®´à®ªà¯à®ªà¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 'à®µà®¾à®²à¯à®¯à¯‚à®®à¯ à®ªà®™à¯à®•à¯à®•à®³à¯');
        }

        function filterData(type) {
            currentFilter = type;
            
            // Update active card
            document.querySelectorAll('.stat-card').forEach(c => {
                c.classList.remove('active');
            });
            document.getElementById(`card-${type}`).classList.add('active');
            
            // Update quick filters
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.quick-filter-btn').classList.add('active');
            
            renderTable();
            showToast(type === 'all' ? 'à®…à®©à¯ˆà®¤à¯à®¤à¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : type === 'buy' ? 'à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯' : 'à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯');
        }

        function toggleView() {
            const tableWrapper = document.querySelector('.table-wrapper');
            const rightPanel = document.querySelector('.right-panel');
            
            if (fullScreenTable) {
                // Show right panel
                rightPanel.style.display = 'flex';
                tableWrapper.style.flex = '1';
                showToast('à®‡à®°à¯ à®ªà®•à¯à®• à®ªà®¾à®°à¯à®µà¯ˆ');
            } else {
                // Hide right panel
                rightPanel.style.display = 'none';
                tableWrapper.style.flex = 'none';
                tableWrapper.style.width = '100%';
                showToast('à®®à¯à®´à¯ à®¤à®¿à®°à¯ˆ à®ªà®¾à®°à¯à®µà¯ˆ');
            }
            
            fullScreenTable = !fullScreenTable;
        }

        // Selection Functions
        function toggleSelection(stockId, isSelected) {
            if (isSelected) {
                selectedStocks.add(stockId);
            } else {
                selectedStocks.delete(stockId);
            }
            updateSelectionCount();
            updateSelectedPanel();
        }

        function toggleSelectAll(checkbox) {
            const allCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            const isChecked = checkbox.checked;
            
            if (isChecked) {
                // Get all currently displayed stock IDs
                const tbody = document.getElementById('tableBody');
                const rows = tbody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        const stockName = row.querySelector('td:nth-child(2)').textContent;
                        const index = checkbox.dataset.index;
                        const stockId = `${stockName}_${index}`;
                        selectedStocks.add(stockId);
                        checkbox.checked = true;
                    }
                });
            } else {
                selectedStocks.clear();
                allCheckboxes.forEach(cb => cb.checked = false);
            }
            
            updateSelectionCount();
            updateSelectedPanel();
        }

        function updateSelectionCount() {
            const count = selectedStocks.size;
            document.getElementById('count-selected').innerText = count;
            document.getElementById('selected-count').innerText = count;
            document.getElementById('panel-selected-count').innerText = count;
            
            // Update selected card
            const selectedCard = document.getElementById('card-selected');
            if (count > 0) {
                selectedCard.style.borderColor = 'var(--purple)';
                selectedCard.style.backgroundColor = 'rgba(156, 39, 176, 0.1)';
            } else {
                selectedCard.style.borderColor = 'transparent';
                selectedCard.style.backgroundColor = '';
            }
        }

        function updateSelectedPanel() {
            const panel = document.getElementById('selectedStocksPanel');
            
            if (selectedStocks.size === 0) {
                panel.innerHTML = `
                    <div style="color: #666; text-align: center; padding: 20px; font-size: 10px;">
                        à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ<br>
                        <small>à®ªà®™à¯à®•à¯ à®ªà¯†à®¯à®°à¯ˆ à®•à®¿à®³à®¿à®•à¯ à®šà¯†à®¯à¯à®¯à®µà¯‹ à®…à®²à¯à®²à®¤à¯ âœ“ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®µà¯‹</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const selectedData = stocksData.filter(stock => selectedStocks.has(stock.id));
            
            selectedData.forEach(stock => {
                const trend = stock.percent > 0 ? 'ğŸŸ¢' : stock.percent < 0 ? 'ğŸ”´' : 'âšª';
                const order = stock.orderBuy === 'buy' ? 'ğŸŸ¢' : stock.orderSell === 'sell' ? 'ğŸ”´' : '';
                
                html += `
                    <div class="selection-item">
                        <div class="selection-item-name">
                            ${trend} ${order} ${stock.stock}
                        </div>
                        <div class="selection-item-value ${stock.percent > 0 ? 'text-green' : stock.percent < 0 ? 'text-red' : ''}">
                            ${stock.percent > 0 ? '+' : ''}${stock.percent.toFixed(2)}%
                        </div>
                        <div class="selection-item-remove" onclick="removeSelection('${stock.id}')" title="à®¨à¯€à®•à¯à®•à¯">
                            Ã—
                        </div>
                    </div>
                `;
            });
            
            panel.innerHTML = html;
        }

        function removeSelection(stockId) {
            selectedStocks.delete(stockId);
            updateSelectionCount();
            updateSelectedPanel();
            renderTable(); // Update checkbox state
            showToast('à®ªà®™à¯à®•à¯ à®¨à¯€à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯');
        }

        function showSelectedStocks() {
            if (selectedStocks.size === 0) {
                showToast('à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ');
                return;
            }
            
            // Filter to show only selected
            currentFilter = 'selected';
            renderTable();
            showToast(`${selectedStocks.size} à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯`);
        }

        function clearSelections() {
            if (selectedStocks.size === 0) return;
            
            if (confirm(`${selectedStocks.size} à®¤à¯‡à®°à¯à®µà¯à®•à®³à¯ˆ à®¨à¯€à®•à¯à®•à¯à®•à®¿à®±à¯€à®°à¯à®•à®³à®¾?`)) {
                selectedStocks.clear();
                document.getElementById('select-all').checked = false;
                updateSelectionCount();
                updateSelectedPanel();
                renderTable();
                showToast('à®…à®©à¯ˆà®¤à¯à®¤à¯ à®¤à¯‡à®°à¯à®µà¯à®•à®³à¯à®®à¯ à®¨à¯€à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®©');
            }
        }

        // WhatsApp Sharing Functions
        function shareSelectedStocks(type) {
            if (stocksData.length === 0) {
                showToast('à®ªà®•à®¿à®°à¯à®µà®¤à®±à¯à®•à¯ à®¤à®°à®µà¯ à®‡à®²à¯à®²à¯ˆ');
                return;
            }
            
            let stocksToShare = [];
            let title = '';
            
            switch(type) {
                case 'buy':
                    stocksToShare = stocksData.filter(s => s.orderBuy === 'buy');
                    title = 'ğŸŸ¢ à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯';
                    break;
                case 'sell':
                    stocksToShare = stocksData.filter(s => s.orderSell === 'sell');
                    title = 'ğŸ”´ à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯';
                    break;
                case 'selected':
                    stocksToShare = stocksData.filter(s => selectedStocks.has(s.id));
                    if (stocksToShare.length === 0) {
                        showToast('à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ');
                        return;
                    }
                    title = 'ğŸ“‹ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿ à®ªà®™à¯à®•à¯à®•à®³à¯';
                    break;
                case 'all':
                    stocksToShare = stocksData.slice(0, 10); // Top 10 only
                    title = 'ğŸ“ˆ à®®à¯à®•à¯à®•à®¿à®¯ à®ªà®™à¯à®•à¯à®•à®³à¯';
                    break;
            }
            
            if (stocksToShare.length === 0) {
                showToast(type === 'buy' ? 'à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ' : 'à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ');
                return;
            }
            
            // Format message
            let message = `${title}\n`;
            message += `----------------\n`;
            
            stocksToShare.forEach((stock, index) => {
                const trend = stock.percent > 0 ? 'ğŸŸ¢' : stock.percent < 0 ? 'ğŸ”´' : 'âšª';
                const order = stock.orderBuy === 'buy' ? 'âœ“' : stock.orderSell === 'sell' ? 'âœ—' : '';
                const changeSign = stock.percent > 0 ? '+' : '';
                
                message += `${index + 1}. ${trend} ${order} ${stock.stock}\n`;
                message += `   à®µà®¿à®²à¯ˆ: â‚¹${stock.price.toFixed(2)}\n`;
                message += `   à®®à®¾à®±à¯à®±à®®à¯: ${changeSign}${stock.percent.toFixed(2)}%\n`;
                
                if (index < stocksToShare.length - 1) {
                    message += `\n`;
                }
            });
            
            message += `\n----------------\n`;
            message += `â° ${new Date().toLocaleTimeString('ta-IN', {hour: '2-digit', minute:'2-digit'})}\n`;
            message += `ğŸ“Š à®®à¯Šà®¤à¯à®¤à®®à¯: ${stocksToShare.length} à®ªà®™à¯à®•à¯à®•à®³à¯`;
            
            // Encode and open WhatsApp
            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
            
            showToast(`${stocksToShare.length} à®ªà®™à¯à®•à¯à®•à®³à¯ WhatsApp à®‡à®²à¯ à®ªà®•à®¿à®°à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯`);
        }

        // Print Functionality
        function setupPrint() {
            const printBtn = document.querySelector('.btn-print');
            if (printBtn) {
                printBtn.onclick = function() {
                    printReport();
                };
            }
        }

        function printReport() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ta-IN');
            const timeStr = now.toLocaleTimeString('ta-IN', {hour: '2-digit', minute:'2-digit'});
            
            // Update print headers
            document.getElementById('print-date').textContent = dateStr;
            document.getElementById('print-time').textContent = timeStr;
            
            // Show print headers/footers
            document.querySelector('.print-header').style.display = 'block';
            document.querySelector('.print-footer').style.display = 'block';
            
            // Add current filter info to print
            const printFooter = document.querySelector('.print-footer');
            printFooter.innerHTML = `
                <div>à®¸à¯à®Ÿà®¾à®•à¯ à®®à®¾à®°à¯à®•à¯à®•à¯†à®Ÿà¯ à®°à®¿à®ªà¯à®ªà¯‹à®°à¯à®Ÿà¯ | à®¤à¯‡à®¤à®¿: ${dateStr} | à®¨à¯‡à®°à®®à¯: ${timeStr}</div>
                <div>${currentFilter === 'buy' ? 'à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯' : 
                       currentFilter === 'sell' ? 'à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 
                       currentFilter === 'gainers' ? 'à®…à®¤à®¿à®•à®°à®¿à®ªà¯à®ªà¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 
                       currentFilter === 'losers' ? 'à®‡à®´à®ªà¯à®ªà¯ à®ªà®™à¯à®•à¯à®•à®³à¯' : 'à®…à®©à¯ˆà®¤à¯à®¤à¯ à®ªà®™à¯à®•à¯à®•à®³à¯'}</div>
                <div>Generated by Stock Dashboard</div>
            `;
            
            // Store last printed date
            lastPrintedDate = `${dateStr} ${timeStr}`;
            
            // Trigger print
            window.print();
            
            // Hide print headers/footers after printing
            setTimeout(() => {
                document.querySelector('.print-header').style.display = 'none';
                document.querySelector('.print-footer').style.display = 'none';
            }, 100);
        }

        function highlightRow(row) {
            row.classList.toggle('highlight-row');
        }

        function updateViewInfo() {
            let info = '';
            
            if (currentFilter === 'all') info = 'à®…à®©à¯ˆà®¤à¯à®¤à¯à®®à¯';
            else if (currentFilter === 'buy') info = 'à®ªà¯ˆ à®ªà®™à¯à®•à¯à®•à®³à¯';
            else if (currentFilter === 'sell') info = 'à®šà¯†à®²à¯ à®ªà®™à¯à®•à¯à®•à®³à¯';
            else if (currentFilter === 'gainers') info = 'à®‰à®¯à®°à¯à®µà¯';
            else if (currentFilter === 'losers') info = 'à®‡à®´à®ªà¯à®ªà¯';
            else if (currentFilter === 'volume') info = 'à®µà®¾à®²à¯à®¯à¯‚à®®à¯';
            else if (currentFilter === 'selected') info = 'à®¤à¯‡à®°à¯à®µà¯';
            
            document.getElementById('viewInfo').textContent = info;
        }

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.innerText = msg;
            t.className = "show";
            setTimeout(() => t.className = "", 2000);
        }

        function updateClock() {
            document.getElementById('clock').innerText = 
                new Date().toLocaleTimeString('ta-IN', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    hour12: false 
                });
        }

        // Initialize
        window.onload = function() {
            loadData();
            updateClock();
            setupPrint();
            
            setInterval(updateClock, 1000);
            setInterval(loadData, 60000); // Auto-refresh every minute
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === '/' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    document.getElementById('searchBox').focus();
                }
                if (e.key === 'Escape') {
                    document.getElementById('searchBox').value = '';
                    searchTerm = '';
                    renderTable();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    printReport();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                    e.preventDefault();
                    filterData('buy');
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    filterData('sell');
                }
            });
            
            // Click outside column selector to close
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.column-toggle')) {
                    const selector = document.getElementById('columnSelector');
                    if (selector) selector.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>